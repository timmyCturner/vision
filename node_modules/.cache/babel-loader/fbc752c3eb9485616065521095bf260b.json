{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kuent\\\\Documents\\\\FinishDipshit\\\\Creative\\\\Ocean-Weather-Visualization\\\\src\\\\OWSonification.js\";\nimport React from \"react\";\nimport * as Tone from \"tone\";\nimport bubbles from \"./sounds/bubbles.wav\";\nimport \"./Child2.css\";\n\nclass Child2 extends React.Component {\n  constructor(props) {\n    super(props); //Setting state\n\n    this.state = {\n      //Sounds load states\n      isLoaded: false,\n      //Effects levels\n      distortionLevel: 0,\n      reverbLevel: 0,\n      //Frequencies\n      trebleFreqs: [523.25, 554.37, 587.33, 622.25, 659.25, 698.46, 739.99, 783.99, 830.61, 880.00, 932.33, 987.77],\n      //C5-B5\n      consonantIntervals: [0, 4, 7, 9],\n      //unison, maj third, perf fifth, maj sixth\n      dissonantIntervals: [1, 2, 3, 5, 6, 8, 10, 11],\n      //min second, maj second, min third, perf fourth, tritone, min sixth, min seventh, maj seventh\n      consonanceProbability: 100,\n      //Synth parameters\n      fatSpread: 0,\n      fatDetune: 0,\n      amHarm: 0,\n      //All audio on/off\n      audioState: false,\n      //Audio layer solo states\n      playbackState: false,\n      fatOscState: false,\n      amOscState: false,\n      //Updating\n      updateCount: 0,\n      dataUpdateCount: 0,\n      //Using Chrome? Change this between browsers\n      chromeFlag: 0\n    }; //Binding functions\n\n    this.initialize = this.initialize.bind(this);\n    this.startAudio = this.startAudio.bind(this);\n    this.getNewData = this.getNewData.bind(this);\n    this.recordAudio = this.recordAudio.bind(this); //Effects\n\n    this.dist = new Tone.Distortion(0).toDestination();\n    this.rev = new Tone.Reverb(1).toDestination(); //Sound sources\n\n    this.buffer = new Tone.ToneAudioBuffer(); //this.buffer.debug = true;\n\n    this.buffer.load(bubbles);\n    this.player = new Tone.Player(this.buffer, () => {\n      // console.log(\"Player ready!\");\n      this.setState({\n        isLoaded: true\n      });\n      this.player.loop = true;\n      this.initialize();\n    }).chain(this.dist, this.rev, Tone.Destination);\n    this.fatOsc = new Tone.FatOscillator(\"C3\", \"sawtooth\", 40).chain(this.dist, this.rev, Tone.Destination);\n    this.am = new Tone.AMOscillator(\"E3\", \"square\", \"sine\").chain(this.dist, this.rev, Tone.Destination);\n    this.fm = new Tone.FMOscillator(\"G3\", \"sine\", \"square\").chain(this.dist, this.rev, Tone.Destination);\n\n    if (this.state.chromeFlag === 1) {\n      this.rec = new Tone.Recorder();\n      Tone.Destination.connect(this.rec);\n    }\n  }\n\n  initialize() {\n    //set state and start Tone\n    this.getNewData();\n    Tone.start();\n    Tone.Transport.start(); //set volume\n\n    this.player.volume.value = -100;\n    this.fatOsc.volume.value = -100;\n    this.am.volume.value = -100; //set effects\n\n    this.dist.wet.rampTo(0);\n    this.dist.distortion = 0; //set frequency\n\n    this.fatOsc.frequency.rampTo(65.41);\n    this.am.frequency.rampTo(this.state.trebleFreqs[0]);\n  }\n\n  getNewData() {\n    //get current date\n    var currDate = this.props.currentDate.getFullYear(); //index: TEMPERATURE\n\n    var index = (currDate - 1880) * this.props.temperatureData.length / 140 - 100;\n    index = Math.round(index); //map from -1 - 1 to 0 - 400 using (value - x1) * (y2 - x2) / (y1 - x1) + x2\n\n    var spread = (this.props.temperatureData[index].station + 1) * (400 - 0) / (1 + 1);\n    this.setState({\n      fatSpread: spread\n    }); //index: MICROPLASTICS\n\n    index = currDate - 1950; //map from 90 to 620 to 100 to 0 using same formula as above\n\n    var cp = (this.props.microGrowth2050[index][1] - 90) * (0 - 100) / (620 + 90) + 100;\n    this.setState({\n      consonanceProbability: cp\n    }); //index: MACROPLASTICS\n\n    index = currDate - 1950; //map from 90 to 620 to 0.5 to 4.0 using same formula as above\n\n    var aH = (this.props.macroGrowth2050[index][1] - 90) * (4.0 - 0.5) / (620 - 90) + 0.5;\n    this.setState({\n      amHarm: aH\n    }); //index: CARBON\n\n    var yearGap = 390;\n    var monthGap = yearGap / 12;\n    var year_index = currDate - 2010;\n    var month_index = this.props.currentDate.getMonth() - 1;\n    var current_index = yearGap * year_index + month_index * monthGap;\n    current_index = current_index | 0; //map from 387 to 413 to 0.0 to 1.0 using same formula as above\n\n    var distLevel = (this.props.carbonData[currDate - 1880].trend - 387) / (413 - 387);\n    this.setState({\n      distortionLevel: distLevel\n    }); //index: SEA LEVEL\n\n    index = currDate - 1880; //map from 0 to 9 to 0 to 1100 using same formula as above\n\n    var detune = 0;\n\n    if (index < 0) {\n      detune = 0;\n    }\n\n    if (currDate > 2013) {\n      detune = this.props.seaLevelRise[2013 - 1880][1] * 1100 / 9;\n    } else {\n      detune = this.props.seaLevelRise[index][1] * 1100 / 9;\n    }\n\n    this.setState({\n      fatDetune: detune\n    });\n  }\n\n  startAudio() {\n    this.getNewData();\n    this.rev.decay = 12;\n    Tone.Transport.scheduleRepeat(time => {\n      //Refresh data\n      this.getNewData(); //Microplastics: Consonance probability\n\n      var rand = Math.random() * 100; //get random number between 0 and 100\n\n      var intervalIndex = 0;\n\n      if (rand < this.state.consonanceProbability) {\n        intervalIndex = Math.floor(Math.random() * 4);\n        this.am.frequency.rampTo(this.state.trebleFreqs[this.state.consonantIntervals[intervalIndex]]);\n      } else {\n        intervalIndex = Math.floor(Math.random() * 8);\n        this.am.frequency.rampTo(this.state.trebleFreqs[this.state.dissonantIntervals[intervalIndex]]);\n      } //Macroplastics: AM harmonicity\n\n\n      this.am.harmonicity.rampTo(this.state.amHarm); //Temperature: Fat osc spread\n\n      this.fatOsc.spread = this.state.fatSpread; //Sea level rise: Fat osc detune\n\n      this.fatOsc.detune.setValueAtTime(this.state.fatDetune, Tone.now()); //Carbon: Distortion level\n\n      this.dist.distortion = this.state.distortionLevel;\n      this.dist.wet.rampTo(this.state.distortionLevel);\n    }, \"1hz\", Tone.now());\n\n    if (this.state.audioState === false) {\n      this.player.start(Tone.now());\n      this.fatOsc.start(Tone.now());\n      this.am.start(Tone.now());\n      this.player.volume.rampTo(0);\n      this.fatOsc.volume.rampTo(-16);\n      this.am.volume.rampTo(-24);\n      this.setState({\n        audioState: true\n      });\n    } else if (this.state.audioState === true) {\n      this.player.volume.rampTo(-100);\n      this.fatOsc.volume.rampTo(-100);\n      this.am.volume.rampTo(-100);\n      this.player.stop(Tone.now());\n      this.fatOsc.stop(Tone.now());\n      this.am.stop(Tone.now());\n      this.setState({\n        audioState: false\n      });\n    }\n  }\n\n  recordAudio() {\n    this.rec.start();\n    setTimeout(async () => {\n      const recording = await this.rec.stop();\n      const url = URL.createObjectURL(recording);\n      const anchor = document.createElement(\"a\");\n      anchor.download = \"recording.webm\";\n      anchor.href = url;\n      anchor.click();\n    }, 20000);\n  }\n\n  render() {\n    const {\n      isLoaded\n    } = this.state; // console.log(this.state);\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"Child2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      disabled: !isLoaded,\n      onClick: this.startAudio,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 17\n      }\n    }, \"audio on/off\"), /*#__PURE__*/React.createElement(\"button\", {\n      disabled: !this.state.chromeFlag,\n      onClick: this.recordAudio,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 17\n      }\n    }, \"record audio\"));\n  }\n\n  componentDidMount() {// console.log(\"Child2 Mounted\");\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {// console.log(\"Child2 Updated\");\n  }\n\n}\n\nexport default Child2;","map":{"version":3,"sources":["C:/Users/kuent/Documents/FinishDipshit/Creative/Ocean-Weather-Visualization/src/OWSonification.js"],"names":["React","Tone","bubbles","Child2","Component","constructor","props","state","isLoaded","distortionLevel","reverbLevel","trebleFreqs","consonantIntervals","dissonantIntervals","consonanceProbability","fatSpread","fatDetune","amHarm","audioState","playbackState","fatOscState","amOscState","updateCount","dataUpdateCount","chromeFlag","initialize","bind","startAudio","getNewData","recordAudio","dist","Distortion","toDestination","rev","Reverb","buffer","ToneAudioBuffer","load","player","Player","setState","loop","chain","Destination","fatOsc","FatOscillator","am","AMOscillator","fm","FMOscillator","rec","Recorder","connect","start","Transport","volume","value","wet","rampTo","distortion","frequency","currDate","currentDate","getFullYear","index","temperatureData","length","Math","round","spread","station","cp","microGrowth2050","aH","macroGrowth2050","yearGap","monthGap","year_index","month_index","getMonth","current_index","distLevel","carbonData","trend","detune","seaLevelRise","decay","scheduleRepeat","time","rand","random","intervalIndex","floor","harmonicity","setValueAtTime","now","stop","setTimeout","recording","url","URL","createObjectURL","anchor","document","createElement","download","href","click","render","componentDidMount","componentDidUpdate","prevProps","prevState","snapshot"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport * as Tone from \"tone\";\r\nimport bubbles from \"./sounds/bubbles.wav\";\r\nimport \"./Child2.css\";\r\n\r\nclass Child2 extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        \r\n        //Setting state\r\n        this.state = { \r\n            //Sounds load states\r\n            isLoaded: false,\r\n\r\n            //Effects levels\r\n            distortionLevel: 0,\r\n            reverbLevel: 0,\r\n\r\n            //Frequencies\r\n            trebleFreqs: [523.25, 554.37, 587.33, 622.25, 659.25, 698.46, 739.99, 783.99, 830.61, 880.00, 932.33, 987.77], //C5-B5\r\n            consonantIntervals: [0, 4, 7, 9], //unison, maj third, perf fifth, maj sixth\r\n            dissonantIntervals: [1, 2, 3, 5, 6, 8, 10, 11], //min second, maj second, min third, perf fourth, tritone, min sixth, min seventh, maj seventh\r\n            consonanceProbability: 100,\r\n            \r\n            //Synth parameters\r\n            fatSpread: 0,\r\n            fatDetune: 0,\r\n            amHarm: 0,\r\n\r\n            //All audio on/off\r\n            audioState: false,\r\n            \r\n            //Audio layer solo states\r\n            playbackState: false,\r\n            fatOscState: false,\r\n            amOscState: false,\r\n            \r\n            //Updating\r\n            updateCount: 0,\r\n            dataUpdateCount: 0,\r\n\r\n            //Using Chrome? Change this between browsers\r\n            chromeFlag: 0\r\n        };\r\n\r\n        //Binding functions\r\n        this.initialize = this.initialize.bind(this);\r\n        this.startAudio = this.startAudio.bind(this);\r\n        this.getNewData = this.getNewData.bind(this);\r\n        this.recordAudio = this.recordAudio.bind(this);\r\n\r\n        //Effects\r\n        this.dist = new Tone.Distortion(0).toDestination();\r\n\r\n        this.rev = new Tone.Reverb(1).toDestination();\r\n\r\n        //Sound sources\r\n        this.buffer = new Tone.ToneAudioBuffer();\r\n        //this.buffer.debug = true;\r\n        this.buffer.load(bubbles);\r\n\r\n        this.player = new Tone.Player(this.buffer, () => {\r\n            // console.log(\"Player ready!\");\r\n            this.setState({ isLoaded: true });\r\n            this.player.loop = true;\r\n            this.initialize();\r\n        }).chain(this.dist, this.rev, Tone.Destination);\r\n\r\n        this.fatOsc = new Tone.FatOscillator(\"C3\", \"sawtooth\", 40).chain(this.dist, this.rev, Tone.Destination);\r\n\r\n        this.am = new Tone.AMOscillator(\"E3\", \"square\", \"sine\").chain(this.dist, this.rev, Tone.Destination);\r\n    \r\n        this.fm = new Tone.FMOscillator(\"G3\", \"sine\", \"square\").chain(this.dist, this.rev, Tone.Destination);\r\n\r\n        if (this.state.chromeFlag === 1) {\r\n            this.rec = new Tone.Recorder();\r\n            Tone.Destination.connect(this.rec);\r\n        }\r\n    }\r\n\r\n    initialize() {\r\n        //set state and start Tone\r\n        this.getNewData();\r\n        Tone.start();\r\n        Tone.Transport.start();\r\n\r\n        //set volume\r\n        this.player.volume.value = -100;\r\n        this.fatOsc.volume.value = -100;\r\n        this.am.volume.value = -100;\r\n\r\n        //set effects\r\n        this.dist.wet.rampTo(0);\r\n        this.dist.distortion = 0;\r\n\r\n        //set frequency\r\n        this.fatOsc.frequency.rampTo(65.41);\r\n        this.am.frequency.rampTo(this.state.trebleFreqs[0]);\r\n    }\r\n\r\n    getNewData() {\r\n        //get current date\r\n        var currDate = this.props.currentDate.getFullYear();\r\n        \r\n        //index: TEMPERATURE\r\n        var index = ((currDate - 1880) * this.props.temperatureData.length) / 140 - 100;\r\n        index = Math.round(index);\r\n\r\n        //map from -1 - 1 to 0 - 400 using (value - x1) * (y2 - x2) / (y1 - x1) + x2\r\n        var spread = (this.props.temperatureData[index].station + 1) * (400 - 0) / (1 + 1);\r\n        this.setState({ fatSpread: spread });\r\n\r\n        //index: MICROPLASTICS\r\n        index = currDate - 1950;\r\n\r\n        //map from 90 to 620 to 100 to 0 using same formula as above\r\n        var cp = (this.props.microGrowth2050[index][1] - 90) * (0 - 100) / (620 + 90) + 100;\r\n        this.setState({ consonanceProbability: cp });        \r\n\r\n        //index: MACROPLASTICS\r\n        index = currDate - 1950;\r\n        \r\n        //map from 90 to 620 to 0.5 to 4.0 using same formula as above\r\n        var aH = (this.props.macroGrowth2050[index][1] - 90) * (4.0 - 0.5) / (620 - 90) + 0.5;\r\n        this.setState({ amHarm: aH });\r\n\r\n        //index: CARBON\r\n        var yearGap = 390;\r\n        var monthGap = yearGap / 12;\r\n        var year_index = currDate - 2010;\r\n        var month_index = this.props.currentDate.getMonth() - 1;\r\n\r\n        var current_index = yearGap * year_index + month_index * monthGap;\r\n        current_index = current_index | 0;\r\n\r\n        //map from 387 to 413 to 0.0 to 1.0 using same formula as above\r\n        var distLevel = (this.props.carbonData[currDate - 1880].trend - 387) / (413 - 387);\r\n        this.setState({ distortionLevel: distLevel });\r\n\r\n        //index: SEA LEVEL\r\n        index = currDate - 1880;\r\n        \r\n        //map from 0 to 9 to 0 to 1100 using same formula as above\r\n        var detune = 0;\r\n\r\n        if (index < 0) {\r\n            detune = 0;\r\n        }\r\n\r\n        if (currDate > 2013) {\r\n            detune = this.props.seaLevelRise[(2013 - 1880)][1] * 1100 / 9;\r\n        }\r\n        else {\r\n            detune = this.props.seaLevelRise[index][1] * 1100 / 9;\r\n        }\r\n        this.setState({ fatDetune: detune });\r\n    }\r\n\r\n    startAudio() {\r\n        this.getNewData();\r\n        this.rev.decay = 12;\r\n\r\n        Tone.Transport.scheduleRepeat((time) => {\r\n            //Refresh data\r\n            this.getNewData();\r\n            \r\n            //Microplastics: Consonance probability\r\n            var rand = Math.random() * 100; //get random number between 0 and 100\r\n\r\n            var intervalIndex = 0;\r\n\r\n            if (rand < this.state.consonanceProbability) {\r\n                intervalIndex = Math.floor(Math.random() * 4);\r\n                this.am.frequency.rampTo(this.state.trebleFreqs[this.state.consonantIntervals[intervalIndex]]);\r\n            }\r\n            else {\r\n                intervalIndex = Math.floor(Math.random() * 8);\r\n                this.am.frequency.rampTo(this.state.trebleFreqs[this.state.dissonantIntervals[intervalIndex]]);\r\n            }\r\n\r\n            //Macroplastics: AM harmonicity\r\n            this.am.harmonicity.rampTo(this.state.amHarm);\r\n            \r\n            //Temperature: Fat osc spread\r\n            this.fatOsc.spread = this.state.fatSpread;\r\n            \r\n            //Sea level rise: Fat osc detune\r\n            this.fatOsc.detune.setValueAtTime(this.state.fatDetune, Tone.now());\r\n\r\n            //Carbon: Distortion level\r\n            this.dist.distortion = this.state.distortionLevel;\r\n            this.dist.wet.rampTo(this.state.distortionLevel);\r\n\r\n        }, \"1hz\", Tone.now());\r\n\r\n        if (this.state.audioState === false) {\r\n            this.player.start(Tone.now());\r\n            this.fatOsc.start(Tone.now());\r\n            this.am.start(Tone.now());\r\n\r\n            this.player.volume.rampTo(0);\r\n            this.fatOsc.volume.rampTo(-16);\r\n            this.am.volume.rampTo(-24);\r\n            this.setState({ audioState: true });\r\n        }\r\n        else if (this.state.audioState === true) {\r\n            this.player.volume.rampTo(-100);\r\n            this.fatOsc.volume.rampTo(-100);\r\n            this.am.volume.rampTo(-100);\r\n\r\n            this.player.stop(Tone.now());\r\n            this.fatOsc.stop(Tone.now());\r\n            this.am.stop(Tone.now());\r\n\r\n            this.setState({ audioState: false });\r\n        }\r\n    }\r\n\r\n    recordAudio() {\r\n        this.rec.start();\r\n\r\n        setTimeout(async () => {\r\n            const recording = await this.rec.stop();\r\n            const url = URL.createObjectURL(recording);\r\n            const anchor = document.createElement(\"a\");\r\n            anchor.download = \"recording.webm\";\r\n            anchor.href = url;\r\n            anchor.click();\r\n        }, 20000);\r\n    }\r\n\r\n    render() {\r\n        const { isLoaded } = this.state;\r\n        // console.log(this.state);\r\n\r\n        return (\r\n            <div className=\"Child2\" >\r\n                <button disabled={!isLoaded} onClick={this.startAudio}>\r\n                    audio on/off\r\n                </button>\r\n\r\n                <button disabled={!this.state.chromeFlag} onClick={this.recordAudio}>\r\n                    record audio\r\n                </button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    componentDidMount() {\r\n        // console.log(\"Child2 Mounted\");\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState, snapshot) {\r\n        // console.log(\"Child2 Updated\");\r\n    }\r\n}\r\n\r\nexport default Child2\r\n\r\n"]},"metadata":{},"sourceType":"module"}